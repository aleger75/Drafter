// Generated by CoffeeScript 1.9.1
(function() {
  'use strict';
  var RootCtrl;

  RootCtrl = function($window, $state, $modal, $rootScope, RootService) {
    this.getUser = function() {
      var token;
      token = $window.localStorage.getItem('token');
      this.user = token ? JSON.parse(atob(token.split('.')[1])) : void 0;
    };
    this.getUser();
    this.signin = function() {
      var self;
      self = this;
      RootService.signin(this.username, this.password).then(function(data) {
        $window.localStorage.setItem('token', data.data.token);
        self.getUser();
        $state.go($state.current.name, {}, {
          reload: true
        });
        $rootScope.modalInstance.close();
      });
    };
    this.register = function() {
      var self;
      self = this;
      return RootService.register(this.username, this.password, this.email, this.firstName, this.lastName).then(function(data) {
        RootService.signin(self.username, self.password).then(function(data) {
          $window.localStorage.setItem('token', data.data.token);
          self.getUser();
          $state.go($state.current.name, {}, {
            reload: true
          });
          return $rootScope.modalInstance.close();
        });
      });
    };
    this.signout = function() {
      $window.localStorage.removeItem('token');
      this.user = void 0;
    };
    this.openSignin = function() {
      $rootScope.modalInstance = $modal.open({
        templateUrl: '/static/js/app/views/signin.html',
        controller: 'RootCtrl',
        controllerAs: 'root'
      });
    };
    this.openRegister = function() {
      $rootScope.modalInstance = $modal.open({
        templateUrl: '/static/js/app/views/register.html',
        controller: 'RootCtrl',
        controllerAs: 'root'
      });
    };
  };

  angular.module('root').controller('RootCtrl', ['$window', '$state', '$modal', '$rootScope', 'RootService', RootCtrl]);

}).call(this);
